<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divélun Pro - Boxing Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-bg': '#050505',
                        'brand-card': '#0a0a0a',
                        'brand-red': '#ff0033', /* Rojo más vibrante/neón */
                        'brand-red-dark': '#cc0029',
                        'brand-text': '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Oswald', 'sans-serif'],
                        mono: ['Roboto Mono', 'monospace'],
                    },
                    boxShadow: {
                        'neon': '0 0 20px rgba(255, 0, 51, 0.4)',
                        'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #020202; color: white; overflow: hidden; }
        
        /* Fondo ambiental animado */
        .ambient-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,0,51,0.15) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
        }

        /* Glassmorphism Avanzado */
        .glass-panel {
            background: rgba(20, 20, 20, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* Texto con sombra elegante */
        .text-glow {
            text-shadow: 0 0 10px rgba(255, 0, 51, 0.5);
        }

        .equalizer-bar {
            transition: height 0.1s ease;
            box-shadow: 0 0 5px rgba(255, 0, 51, 0.8);
        }

        /* Ocultar scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-0 sm:p-4 relative">

    <!-- Luz ambiental de fondo -->
    <div class="ambient-glow top-0 left-0 translate-x-[-30%] translate-y-[-30%]"></div>
    <div class="ambient-glow bottom-0 right-0 translate-x-[30%] translate-y-[30%]"></div>

    <!-- App Container -->
    <div class="relative w-full max-w-md bg-brand-card sm:rounded-[32px] overflow-hidden shadow-2xl border border-white/5 h-[100vh] sm:h-auto sm:min-h-[850px] flex flex-col z-10">
        
        <!-- HEADER con efecto Glass leve -->
        <div class="flex justify-between items-center p-6 bg-gradient-to-b from-black/80 to-transparent absolute top-0 w-full z-30 pointer-events-none">
            <div class="flex items-center gap-2 pointer-events-auto">
                <div class="w-1 h-6 bg-brand-red shadow-[0_0_10px_#ff0033]"></div>
                <h1 class="text-2xl tracking-widest font-bold text-white italic drop-shadow-md">DIVÉLUN <span class="text-brand-red text-glow">PRO</span></h1>
            </div>
            <!-- Indicador de estado -->
            <div class="flex items-center gap-2 bg-black/40 backdrop-blur-sm px-3 py-1 rounded-full border border-white/10 pointer-events-auto">
                <div class="w-1.5 h-1.5 rounded-full bg-brand-red animate-pulse"></div>
                <span class="text-[10px] font-mono text-neutral-300 tracking-wider">LIVE AI</span>
            </div>
        </div>

        <!-- AREA DE VIDEO -->
        <div class="relative w-full aspect-[9/16] sm:aspect-video bg-black flex-shrink-0 group flex items-center justify-center overflow-hidden">
            
            <!-- VIDEO PLAYER (Sin autoplay en HTML para controlar errores en JS) -->
            <video id="exerciseVideo" 
                   class="w-full h-full object-cover sm:object-contain opacity-90" 
                   loop muted playsinline>
                <source src="v-x9z2-sh01-div.mp4" type="video/mp4">
                <source src="https://assets.mixkit.co/videos/preview/mixkit-boxing-training-in-a-gym-4833-large.mp4" type="video/mp4">
            </video>

            <!-- Gradiente cinemático inferior -->
            <div class="absolute bottom-0 left-0 w-full h-48 bg-gradient-to-t from-brand-card via-brand-card/90 to-transparent pointer-events-none"></div>
            
            <!-- Título Técnica Flotante -->
            <div class="absolute bottom-12 left-6 z-10">
                <h2 class="text-5xl font-bold italic text-white leading-none drop-shadow-2xl">JAB <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-red to-red-600">MASTER</span></h2>
                <div class="flex items-center gap-2 mt-2">
                    <span class="bg-brand-red/20 text-brand-red text-[10px] font-mono px-2 py-0.5 border border-brand-red/30 rounded uppercase tracking-wider">Módulo 1</span>
                    <p class="text-xs text-neutral-400 font-sans tracking-wide uppercase">Striking Fundamentals</p>
                </div>
            </div>
        </div>

        <!-- CONTROLES Y HUD (Heads Up Display) -->
        <div class="flex-1 bg-brand-card flex flex-col relative z-20 -mt-6">
            
            <!-- Panel Glassmorphic Principal -->
            <div class="glass-panel mx-4 rounded-2xl p-6 flex flex-col gap-5 relative shadow-glass transition-transform duration-300 hover:scale-[1.01]">
                
                <!-- Feedback del Entrenador -->
                <div class="flex justify-between items-center border-b border-white/5 pb-4">
                    <div class="flex flex-col">
                        <span class="text-brand-red text-[10px] font-bold tracking-[0.2em] uppercase mb-1 shadow-red-500/20">Estado del Sistema</span>
                        <div class="flex items-center gap-2 h-6">
                            <span id="coachStatus" class="text-white font-sans text-lg tracking-wide transition-all duration-300">Iniciando análisis...</span>
                        </div>
                    </div>
                    <!-- Ecualizador Minimalista -->
                    <div id="equalizer" class="flex items-end gap-1 h-6 opacity-80">
                        <!-- Barras JS -->
                    </div>
                </div>

                <!-- Botón de Acción Principal (Estilo Cyberpunk) -->
                <button id="mainActionBtn" onclick="toggleSession()" class="group relative w-full h-14 bg-gradient-to-r from-neutral-800 to-neutral-900 hover:from-neutral-700 hover:to-neutral-800 border border-white/10 rounded-xl overflow-hidden shadow-lg transition-all duration-300 active:scale-[0.98]">
                    
                    <!-- Brillo al hacer hover -->
                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    
                    <div class="relative flex items-center justify-center gap-3 h-full">
                        <span id="btnIcon" class="text-brand-red transition-transform group-hover:scale-110 duration-300">
                            <!-- Icono dinámico -->
                            <svg class="w-5 h-5 drop-shadow-[0_0_8px_rgba(255,0,51,0.6)]" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        </span>
                        <span id="btnText" class="text-white font-bold tracking-widest text-sm uppercase group-hover:text-white/90">Pausar Sesión</span>
                    </div>
                </button>
            </div>

            <!-- Panel de Métricas (Grid inferior) -->
            <div class="mt-6 px-8 grid grid-cols-2 gap-8 opacity-80">
                <div class="flex flex-col items-center border-r border-white/5">
                    <p class="text-neutral-500 text-[10px] uppercase tracking-[0.2em] mb-1">Impacto</p>
                    <div class="flex items-baseline gap-1">
                        <p class="text-2xl font-mono font-bold text-white">98</p>
                        <span class="text-xs text-brand-red">%</span>
                    </div>
                </div>
                <div class="flex flex-col items-center">
                    <p class="text-neutral-500 text-[10px] uppercase tracking-[0.2em] mb-1">Duración</p>
                    <div class="flex items-baseline gap-1">
                        <p id="timer" class="text-2xl font-mono font-bold text-white">00:00</p>
                        <span class="text-xs text-neutral-600">MIN</span>
                    </div>
                </div>
            </div>

            <!-- Footer Decorativo -->
            <div class="mt-auto pb-8 pt-4 flex flex-col items-center gap-2 opacity-40">
                <div class="h-0.5 w-12 bg-white/20 rounded-full"></div>
                <p class="text-[9px] font-mono text-white/60 tracking-widest">POWERED BY DIVÉLUN ENGINE</p>
            </div>
        </div>
    </div>

    <script>
        // --- GUION DEL ENTRENADOR ---
        const coachScript = "¡Guardia arriba! Vamos a pulir ese Jab. Escúchame bien: Primero, los pies. Plántalos firmes, no quiero que te caigas si te soplan. Ahora, dispara ese brazo delantero recto, ¡como una flecha! Nada de movimientos curvos. Ojo al detalle: justo antes de pegar, gira el puño hacia abajo. Eso corta la piel y duele más. Y muy importante: exhala fuerte al golpear... ¡Shhh! ¿Y lo principal? Regresa esa mano a tu cara más rápido de lo que salió. No querrás que te duerman de un contraataque, ¿o sí? ¡Vamos, hazlo de nuevo con fuerza!";

        // Elementos DOM
        const video = document.getElementById('exerciseVideo');
        const btnText = document.getElementById('btnText');
        const btnIcon = document.getElementById('btnIcon');
        const coachStatus = document.getElementById('coachStatus');
        const equalizer = document.getElementById('equalizer');
        const timerDisplay = document.getElementById('timer');

        let synth = window.speechSynthesis;
        let utterance = null;
        let animationId;
        let seconds = 0;
        let timerInterval;
        let isSessionActive = true; 

        // SVG Icons
        const iconPause = '<svg class="w-5 h-5 drop-shadow-[0_0_8px_rgba(255,0,51,0.6)]" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        const iconPlay = '<svg class="w-5 h-5 drop-shadow-[0_0_8px_rgba(255,0,51,0.6)]" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';

        // 1. INICIALIZACIÓN AUTOMÁTICA SEGURA
        window.onload = function() {
            initEqualizer();
            startTimer();
            
            // Intento de reproducción segura con manejo de promesas
            const playPromise = video.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // Reproducción automática exitosa
                    setTimeout(() => {
                        speakCoach(coachScript);
                    }, 1000);
                })
                .catch(error => {
                    console.log("Autoplay prevenido por el navegador o interrumpido:", error);
                    // Si falla el autoplay, actualizamos la UI a estado pausado
                    isSessionActive = false;
                    updateUIState(false);
                    coachStatus.innerText = "Listo para iniciar";
                });
            }
        };

        // 2. CONTROL DE SESIÓN (Botón)
        function toggleSession() {
            if (isSessionActive) {
                // PAUSAR
                video.pause();
                synth.cancel();
                stopTimer();
                updateUIState(false);
                isSessionActive = false;
            } else {
                // REANUDAR CON MANEJO DE ERRORES
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        speakCoach(coachScript);
                        startTimer();
                        updateUIState(true);
                        isSessionActive = true;
                    })
                    .catch(error => {
                        console.error("Error al reanudar:", error);
                    });
                }
            }
        }

        // 3. MOTOR DE VOZ
        function speakCoach(text) {
            if (synth.speaking) synth.cancel();

            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-MX'; 
            utterance.rate = 1.1;     
            utterance.pitch = 1.0;

            utterance.onstart = () => {
                coachStatus.innerText = "Corrigiendo técnica..."; // Texto activo
                coachStatus.className = "text-brand-red font-sans text-lg tracking-wide animate-pulse text-glow";
                animateEqualizer(true);
            };

            utterance.onend = () => {
                coachStatus.innerText = "Análisis Activo"; // Texto neutral
                coachStatus.className = "text-white font-sans text-lg tracking-wide";
                animateEqualizer(false);
            };

            utterance.onerror = (e) => {
                console.log("Error de voz:", e);
                animateEqualizer(false);
            };

            const voices = synth.getVoices();
            const googleVoice = voices.find(v => v.name.includes('Google') && v.lang.includes('es'));
            if (googleVoice) utterance.voice = googleVoice;

            synth.speak(utterance);
        }

        // 4. ACTUALIZAR UI
        function updateUIState(active) {
            if (active) {
                btnText.innerText = "PAUSAR SESIÓN";
                btnIcon.innerHTML = iconPause;
                btnIcon.classList.remove('pl-1'); 
            } else {
                btnText.innerText = "REANUDAR";
                btnIcon.innerHTML = iconPlay;
                btnIcon.classList.add('pl-1'); 
                coachStatus.innerText = "Sesión Pausada";
                coachStatus.className = "text-neutral-500 font-sans text-lg tracking-wide";
            }
        }

        // 5. VISUALIZADOR ECUALIZADOR
        function initEqualizer() {
            equalizer.innerHTML = '';
            for(let i=0; i<6; i++) {
                const bar = document.createElement('div');
                bar.className = 'equalizer-bar w-1 bg-brand-red rounded-full';
                bar.style.height = '4px';
                equalizer.appendChild(bar);
            }
        }
        
        function animateEqualizer(active) {
            const bars = document.querySelectorAll('.equalizer-bar');
            if (!active) {
                bars.forEach(b => b.style.height = '4px');
                cancelAnimationFrame(animationId);
                return;
            }

            function loop() {
                bars.forEach(b => {
                    const h = Math.random() * 20 + 4;
                    b.style.height = `${h}px`;
                });
                setTimeout(() => {
                    animationId = requestAnimationFrame(loop);
                }, 80);
            }
            loop();
        }

        // 6. TIMER
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                timerDisplay.innerText = `${m}:${s}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Cargar voces en Chrome (evento asíncrono)
        window.speechSynthesis.onvoiceschanged = () => {};

    </script>
</body>
</html>
