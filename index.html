<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divélun Pro - Boxing Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-bg': '#000000',
                        'brand-card': '#111111',
                        'brand-red': '#ff0033', 
                        'brand-text': '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Oswald', 'sans-serif'],
                        mono: ['Roboto Mono', 'monospace'],
                    },
                    boxShadow: {
                        'neon': '0 0 15px rgba(255, 0, 51, 0.5)',
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #000; color: white; }
        
        /* Ocultar scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        .btn-pulse {
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 51, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0); }
        }
    </style>
</head>
<body class="bg-black min-h-screen flex flex-col items-center justify-start sm:justify-center p-0">

    <!-- Contenedor Principal (Estilo App Móvil) -->
    <div class="w-full max-w-md bg-brand-card min-h-screen sm:min-h-0 sm:h-auto sm:rounded-[30px] sm:border border-gray-800 shadow-2xl flex flex-col relative overflow-hidden">

        <!-- 1. HEADER (Título) -->
        <div class="p-5 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent z-20 absolute top-0 w-full">
            <div class="flex items-center gap-2">
                <div class="w-1 h-6 bg-brand-red shadow-neon"></div>
                <h1 class="text-xl font-bold italic tracking-wider">DIVÉLUN <span class="text-brand-red">PRO</span></h1>
            </div>
            <div class="bg-black/50 px-2 py-1 rounded border border-white/10">
                <span class="text-[10px] text-gray-300 font-mono tracking-widest">DRILL #01</span>
            </div>
        </div>

        <!-- 2. VIDEO PLAYER (Autoplay Independiente) -->
        <div class="relative w-full aspect-video bg-black mt-0 sm:mt-0 shadow-lg z-10">
            <!-- Añadido autoplay para iniciar solo -->
            <video id="exerciseVideo" 
                   class="w-full h-full object-contain" 
                   autoplay muted playsinline loop>
                <source src="v-x9z2-sh01-div.mp4" type="video/mp4">
                <source src="https://assets.mixkit.co/videos/preview/mixkit-boxing-training-in-a-gym-4833-large.mp4" type="video/mp4">
            </video>
            
            <!-- Gradiente para que el texto se lea bien -->
            <div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-brand-card to-transparent pointer-events-none"></div>

            <!-- Título del Ejercicio -->
            <div class="absolute bottom-4 left-5 z-20">
                <h2 class="text-3xl font-bold italic text-white drop-shadow-md">JAB <span class="text-brand-red">MASTER</span></h2>
            </div>
        </div>

        <!-- 3. PANEL DE CONTROL (Debajo del video) -->
        <div class="flex-1 p-6 flex flex-col gap-6 bg-brand-card relative z-20">
            
            <!-- Botón Específico para Instrucciones (Audio Solo) -->
            <button onclick="playInstructionsOnly()" class="flex items-center justify-center gap-2 w-full py-3 rounded-xl border border-gray-700 bg-gray-900/50 hover:bg-gray-800 transition-colors text-gray-300 text-sm uppercase tracking-wider font-sans mb-2">
                <svg class="w-4 h-4 text-brand-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                Escuchar Instrucciones
            </button>

            <!-- Tarjetas de Métricas -->
            <div class="grid grid-cols-2 gap-4">
                <!-- Cronómetro (Cuenta Regresiva con Ajuste) -->
                <div class="bg-black/40 rounded-2xl p-4 border border-white/5 flex flex-col items-center relative group">
                    <span class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Tiempo Restante</span>
                    <div class="text-3xl font-mono font-bold text-white tracking-tighter mb-2" id="timerDisplay">01:00</div>
                    
                    <!-- Controles de Tiempo (NUEVO) -->
                    <div class="flex gap-2 w-full justify-center">
                        <button onclick="adjustTime(-10)" class="text-[10px] bg-gray-800 hover:bg-gray-700 text-gray-300 px-2 py-1 rounded transition-colors">-10s</button>
                        <button onclick="adjustTime(30)" class="text-[10px] bg-brand-red/20 border border-brand-red/50 hover:bg-brand-red text-white px-2 py-1 rounded transition-colors">+30s</button>
                    </div>
                </div>

                <!-- Calorías (Fijas) -->
                <div class="bg-black/40 rounded-2xl p-4 border border-white/5 flex flex-col items-center justify-center">
                    <span class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Quema Estimada</span>
                    <div class="flex items-baseline gap-1">
                        <!-- Valor fijo -->
                        <span class="text-3xl font-mono font-bold text-brand-red tracking-tighter">45</span>
                        <span class="text-xs text-gray-400">KCAL</span>
                    </div>
                </div>
            </div>

            <!-- BOTÓN PRINCIPAL (Controla SOLO el Cronómetro) -->
            <div class="mt-2">
                <button id="mainBtn" onclick="toggleTimer()" class="w-full py-5 bg-brand-red hover:bg-red-600 active:scale-[0.98] transition-all rounded-2xl shadow-neon flex items-center justify-center gap-3 group relative overflow-hidden">
                    <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span id="btnIcon">
                        <!-- Icono Play -->
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </span>
                    <span id="btnText" class="text-white font-bold text-lg tracking-widest uppercase">INICIAR ASALTO</span>
                </button>
                <p id="statusText" class="text-center text-[10px] text-gray-500 mt-3 font-mono uppercase tracking-widest">Listo para comenzar</p>
            </div>

            <!-- Navegación Inferior -->
            <div class="mt-auto grid grid-cols-2 gap-4 pt-4 border-t border-white/5">
                <button class="py-3 rounded-lg text-gray-500 hover:text-white text-xs uppercase tracking-widest font-bold transition-colors">
                    &larr; Anterior
                </button>
                <button class="py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-xs uppercase tracking-widest font-bold transition-colors">
                    Siguiente &rarr;
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const DRILL_TIME = 60; // 60 segundos cuenta regresiva inicial
        
        const coachScript = "¡Guardia arriba! Vamos a pulir ese Jab. Pies firmes. Dispara ese brazo delantero recto como una flecha. Gira el puño al final para cortar. Exhala fuerte al golpear. ¡Shhh! Y regresa la mano rápido a la cara. ¡Vamos, con fuerza!";
        // Audio final actualizado según petición
        const finishScript = "¡Terminó el tiempo campeón! ¿Quieren agregar más tiempo o continuar a la siguiente lección?";

        // DOM Elements
        const timerDisplay = document.getElementById('timerDisplay');
        const mainBtn = document.getElementById('mainBtn');
        const btnText = document.getElementById('btnText');
        const btnIcon = document.getElementById('btnIcon');
        const statusText = document.getElementById('statusText');
        const video = document.getElementById('exerciseVideo');

        // Estado
        let timeLeft = DRILL_TIME;
        let isRunning = false;
        let isFinished = false; // Nuevo estado para saber si terminó
        let timerInterval;
        let synth = window.speechSynthesis;
        let utterance = null;

        // Iconos SVG
        const iconPlay = '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
        const iconPause = '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        const iconReset = '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>';

        // Asegurar que el video se reproduzca al cargar
        window.onload = function() {
            video.play().catch(e => console.log("Autoplay handled by browser/user interaction"));
        };

        // 1. SOLO ESCUCHAR INSTRUCCIONES
        function playInstructionsOnly() {
            if (synth.speaking) {
                synth.cancel();
            } else {
                speak(coachScript);
            }
        }

        // 2. AJUSTAR TIEMPO (NUEVA FUNCIÓN)
        function adjustTime(seconds) {
            timeLeft += seconds;
            if (timeLeft < 0) timeLeft = 0;
            
            updateTimerUI();

            // Si se agrega tiempo cuando ya había terminado, reseteamos el estado "Terminado"
            if (isFinished && timeLeft > 0) {
                isFinished = false;
                // Restauramos botón a estado inicial o Play
                btnText.innerText = "REANUDAR CRONÓMETRO";
                btnIcon.innerHTML = iconPlay;
                statusText.innerText = "Tiempo añadido";
                statusText.className = "text-center text-[10px] text-gray-500 mt-3 font-mono uppercase tracking-widest";
                mainBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                mainBtn.classList.add('bg-brand-red');
            }
        }

        // 3. CONTROL DEL CRONÓMETRO
        function toggleTimer() {
            // Si terminó y no se ha agregado tiempo, es un reset completo
            if (timeLeft <= 0 && isFinished) {
                resetTimer();
                return;
            }

            // Si está corriendo, pausamos
            if (isRunning) {
                pauseTimer();
            } else {
                // Si no está corriendo, iniciamos
                if (timeLeft > 0) {
                    startTimer();
                } else {
                    // Caso borde: 0 tiempo pero usuario quiere iniciar
                    resetTimer();
                }
            }
        }

        function startTimer() {
            isRunning = true;
            isFinished = false;
            
            // UI Update
            btnText.innerText = "PAUSAR CRONÓMETRO";
            btnIcon.innerHTML = iconPause;
            statusText.innerText = "Cronómetro corriendo...";
            statusText.className = "text-center text-[10px] text-brand-red mt-3 font-mono uppercase tracking-widest animate-pulse";
            mainBtn.classList.remove('bg-brand-red');
            mainBtn.classList.add('bg-gray-800', 'border', 'border-gray-600');

            // Timer Logic
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerUI();
                } else {
                    finishTimer();
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);

            // UI Update
            btnText.innerText = "REANUDAR";
            btnIcon.innerHTML = iconPlay;
            statusText.innerText = "Pausado";
            statusText.classList.remove('text-brand-red', 'animate-pulse');
            statusText.classList.add('text-gray-500');
            
            mainBtn.classList.add('bg-brand-red');
            mainBtn.classList.remove('bg-gray-800', 'border', 'border-gray-600');
        }

        function finishTimer() {
            pauseTimer(); // Detener intervalo
            timeLeft = 0;
            isFinished = true;
            updateTimerUI();
            
            // UI Final
            btnText.innerText = "REINICIAR ASALTO";
            btnIcon.innerHTML = iconReset;
            statusText.innerText = "¡ASALTO COMPLETADO!";
            statusText.className = "text-center text-[12px] text-green-500 mt-3 font-bold uppercase tracking-widest";
            mainBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            mainBtn.classList.remove('bg-brand-red');

            speak(finishScript);
        }

        function resetTimer() {
            timeLeft = DRILL_TIME;
            isFinished = false;
            updateTimerUI();
            
            mainBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            mainBtn.classList.add('bg-brand-red');
            statusText.innerText = "Listo para comenzar";
            statusText.className = "text-center text-[10px] text-gray-500 mt-3 font-mono uppercase tracking-widest";
            
            startTimer();
        }

        // 4. ACTUALIZACIONES DE UI
        function updateTimerUI() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            timerDisplay.innerText = `${m}:${s}`;
        }

        // 5. MOTOR DE VOZ
        function speak(text) {
            if (synth.speaking) synth.cancel();
            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-MX';
            utterance.rate = 1.1;
            
            // Intentar voz de Google
            const voices = synth.getVoices();
            const googleVoice = voices.find(v => v.name.includes('Google') && v.lang.includes('es'));
            if (googleVoice) utterance.voice = googleVoice;

            synth.speak(utterance);
        }

        // Cargar voces
        window.speechSynthesis.onvoiceschanged = () => {};

    </script>
</body>
</html>
